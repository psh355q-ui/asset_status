# User Flow (사용자 흐름도)

> Mermaid 플로우차트로 핵심 기능의 주요 여정을 표현합니다.
> 성공/실패 분기를 포함하고, 온보딩→핵심작업→리텐션 루프를 표현합니다.

---

## MVP 캡슐

| # | 항목 | 내용 |
|---|------|------|
| 1 | 목표 | 예금만 하던 투자 초보자가 AI 조언을 받으며 적극적으로 자산을 증식할 수 있도록 지원 |
| 2 | 페르소나 | 30대 후반 직장인, 투자 경험 없음, 가용자산 2억원, 월급 400만원 |
| 3 | 핵심 기능 | FEAT-1: 계좌별 자산현황 조회, FEAT-2: AI 투자조언 (매수/매도 추천) |
| 4 | 성공 지표 (노스스타) | 1년 자산 10% 증가 |
| 5 | 입력 지표 | AI 조언 vs 실제 결과 비교 (백테스팅), 주간 대시보드 확인 3회 이상 |
| 6 | 비기능 요구 | 모바일 반응형 웹, 데이터 영속성 (로컬 PC/NAS), 5초 이내 응답 |
| 7 | Out-of-scope | 증권사 계좌 자동 연동, 자동 매매, 세금 계산, 알림 시스템 |
| 8 | Top 리스크 | AI 조언이 부정확하여 사용자가 손실을 입을 가능성 |
| 9 | 완화/실험 | AI 조언 히스토리 추적, 백테스팅으로 정확도 개선, 면책 고지 |
| 10 | 다음 단계 | API 계약 정의 (Phase 0) 후 TDD 개발 시작 |

---

## 1. 전체 사용자 여정 (Overview)

```mermaid
graph TD
    A[앱 진입] --> B{로그인 상태?}
    B -->|No| C[FEAT-0: 온보딩/로그인]
    B -->|Yes| D[대시보드 메인]
    C --> D
    D --> E{어떤 작업?}
    E -->|자산 확인| F[FEAT-1: 계좌별 자산현황]
    E -->|거래 입력| G[FEAT-1: 거래 내역 입력]
    E -->|AI 조언| H[FEAT-2: AI 투자조언 조회]
    F --> I[리텐션 루프]
    G --> I
    H --> I
    I --> D
```

---

## 2. FEAT-0: 온보딩/로그인 플로우

```mermaid
graph TD
    A[첫 화면] --> B{계정 있음?}

    %% 신규 사용자
    B -->|No| C[회원가입]
    C --> D[이메일 입력]
    D --> E[비밀번호 설정]
    E --> F[계정 생성 완료]
    F --> G[대시보드 메인]

    %% 기존 사용자
    B -->|Yes| H[로그인]
    H --> I[이메일/비밀번호 입력]
    I --> J{인증 성공?}
    J -->|Yes| G
    J -->|No| K[에러 표시]
    K --> I
```

---

## 3. FEAT-1: 계좌별 자산현황 조회 플로우

```mermaid
graph TD
    A[대시보드 진입] --> B[총 자산 요약 표시]
    B --> C[계좌별 목록 표시]
    C --> D{어떤 작업?}

    D -->|계좌 추가| E[계좌 생성 폼]
    E --> F[계좌 타입 선택]
    F --> G[계좌명 입력]
    G --> H[저장]
    H --> C

    D -->|거래 입력| I[거래 입력 폼]
    I --> J[계좌 선택]
    J --> K[종목/수량/가격/날짜 입력]
    K --> L[매수/매도 선택]
    L --> M{입력 검증?}
    M -->|통과| N[저장]
    M -->|실패| O[에러 표시]
    O --> I
    N --> P[보유 현황 자동 재계산]
    P --> C

    D -->|상세 보기| Q[계좌 상세 화면]
    Q --> R[보유 주식 목록]
    R --> S[실현/미실현 수익 표시]
```

---

## 4. FEAT-2: AI 투자조언 플로우

```mermaid
graph TD
    A[대시보드에서 AI 조언 버튼] --> B[보유 주식 목록 표시]
    B --> C[종목 선택]
    C --> D[AI 분석 시작]
    D --> E{분석 성공?}

    E -->|Yes| F[조언 결과 표시]
    F --> G["결론 우선 표시 (매수/매도/보유)"]
    G --> H["근거 요약 (3줄)"]
    H --> I{상세 보기?}
    I -->|Yes| J[상세 분석 펼치기]
    J --> K[뉴스/재무제표/기술적 분석]
    I -->|No| L[조언 히스토리에 저장]

    E -->|No| M[에러 안내]
    M --> N["외부 API 장애 또는 AI 오류"]
    N --> O[재시도 버튼]
    O --> D

    L --> P{다른 종목 조회?}
    P -->|Yes| B
    P -->|No| Q[대시보드로 돌아가기]
```

---

## 5. 리텐션 루프 (습관 형성)

```mermaid
graph TD
    A[거래 입력 완료] --> B[보유 현황 즉시 업데이트]
    B --> C["수익률 변화 피드백 (+3.2%)"]

    D[시간 경과 - 주중 아침] --> E[사용자가 자발적으로 앱 접속]
    E --> F[대시보드에서 자산 증감 확인]
    F --> G{FOMO 느낌?}
    G -->|Yes| H[AI 조언 조회]
    H --> I[조언대로 거래 실행]
    I --> A

    G -->|No| J[그냥 확인만]
    J --> K{주말?}
    K -->|Yes| L[주간 리포트 확인]
    L --> M["AI 조언 vs 실제 결과 비교"]
    M --> N{AI 정확도 높음?}
    N -->|Yes| O[다음 주 AI 조언 신뢰도 증가]
    O --> E

    N -->|No| P[AI 조언 무시하고 직접 판단]
    P --> E
```

---

## 6. 에러 처리 플로우

```mermaid
graph TD
    A[에러 발생] --> B{에러 유형?}

    B -->|네트워크 오류| C["외부 API 연결 실패 (yfinance)"]
    C --> D[캐시 데이터 사용 안내]
    D --> E[재시도 버튼]

    B -->|입력 오류| F[필드별 에러 표시]
    F --> G["예: 수량은 0보다 커야 함"]
    G --> H[사용자 수정]
    H --> I[재제출]

    B -->|AI 오류| J["AI 분석 실패 (OpenAI API)"]
    J --> K[면책 고지 표시]
    K --> L[나중에 재시도 안내]

    B -->|서버 오류| M[500 에러]
    M --> N[서버 재시작 안내]
    N --> O[고객센터 연락처 표시]
```

---

## 7. 화면 목록 (Screen Inventory)

| 화면 ID | 화면명 | FEAT | 진입점 | 주요 액션 |
|---------|--------|------|--------|----------|
| S-01 | 로그인 화면 | FEAT-0 | 앱 실행 | 이메일/비밀번호 입력 |
| S-02 | 회원가입 | FEAT-0 | S-01 | 계정 생성 |
| S-03 | 대시보드 메인 | - | S-01, S-02 | 총 자산 요약, 계좌 목록 |
| S-04 | 계좌 상세 | FEAT-1 | S-03 | 보유 주식 목록, 수익률 |
| S-05 | 거래 입력 | FEAT-1 | S-03, S-04 | 매수/매도 입력 |
| S-06 | AI 조언 | FEAT-2 | S-03, S-04 | 종목별 투자 조언 조회 |
| S-07 | 조언 히스토리 | FEAT-2 | S-06 | 과거 AI 조언 목록 |

---

## Decision Log 참조

| ID | 항목 | 선택 | 이유 |
|----|------|------|------|
| UF-01 | 홈 화면 | 대시보드 (총 자산 요약) | 사용자가 가장 먼저 보고 싶은 정보 |
| UF-02 | AI 조언 진입 | 대시보드에서 직접 접근 | 고빈도 사용 예상 |
| UF-03 | 거래 입력 | 수동 입력 폼 | 증권사 API 연동 불가 |
| UF-04 | 에러 처리 | 친절한 안내 + 재시도 | 투자 초보자 배려 |
